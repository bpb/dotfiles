# macOS-first Zsh, managed by Oh My Zsh (OMZ) with Powerlevel10k theme.

# ---- Homebrew path (Apple Silicon) ----
[ -d "/opt/homebrew/bin" ] && PATH="/opt/homebrew/bin:$PATH"
[ -d "$HOME/.local/bin" ]  && PATH="$HOME/.local/bin:$PATH"

# ---- GNU toolchain first (Linux-like behavior) ----
if command -v brew >/dev/null 2>&1; then
  PATH="$(brew --prefix coreutils)/libexec/gnubin:$PATH"
  PATH="$(brew --prefix findutils)/libexec/gnubin:$PATH"
  PATH="$(brew --prefix gnu-sed)/libexec/gnubin:$PATH"
  export MANPATH="$(brew --prefix coreutils)/libexec/gnuman:$(brew --prefix)/share/man:$MANPATH"
fi
export PATH

# ---- Editors ----
export EDITOR=nvim
export VISUAL=nvim
alias vi='nvim'
alias vim='nvim'
alias old_vi='command vi'
alias old_vim='command vim'

# ---- OMZ core ----
export ZSH="$HOME/.oh-my-zsh"
ZSH_THEME="powerlevel10k/powerlevel10k"
plugins=(
  git
  zoxide
  direnv
  zsh-autosuggestions
  zsh-syntax-highlighting
)

# Load OMZ (does nothing if not installed yet—bootstrap installs it)
[ -s "$ZSH/oh-my-zsh.sh" ] && source "$ZSH/oh-my-zsh.sh"

# Load personal Powerlevel10k config if present
[[ -r ~/.p10k.zsh ]] && source ~/.p10k.zsh

# ---- fzf keybindings/completion (if installed) ----
if command -v fzf >/dev/null 2>&1; then
  [ -f "$(brew --prefix)/opt/fzf/shell/key-bindings.zsh" ] && source "$(brew --prefix)/opt/fzf/shell/key-bindings.zsh"
  [ -f "$(brew --prefix)/opt/fzf/shell/completion.zsh" ]    && source "$(brew --prefix)/opt/fzf/shell/completion.zsh"
fi

# ---- Optional tool hooks ----
command -v direnv  >/dev/null 2>&1 && eval "$(direnv hook zsh)"
command -v zoxide  >/dev/null 2>&1 && eval "$(zoxide init zsh)"
command -v rtx     >/dev/null 2>&1 && eval "$(rtx activate zsh)"

# ---- Safer deletion: rm -> Trash (interactive only) ----
if [[ $- == *i* ]] && command -v trash >/dev/null 2>&1; then
  realrm() { command /bin/rm "$@"; }
  trashrm() {
    local args=()
    for a in "$@"; do [[ "$a" == -* ]] || args+=("$a"); done
    [[ ${#args[@]} -gt 0 ]] || { echo "Usage: rm <files...>"; return 1; }
    trash "${args[@]}"
    echo "🗑️  Moved to Trash. Tip: use 'rmv' next time. Use 'realrm' to permanently delete."
  }
  alias rm='trashrm'
  alias rmv='trash'
  setopt RM_STAR_WAIT 2>/dev/null || true
  alias trash-clean='trash-empty --days 14 || true'
fi

# ---- Aliases ----
alias ll='ls -lah'
alias la='ls -A'
alias l='ls -CF'
command -v lazygit    >/dev/null 2>&1 && alias lg='lazygit'
command -v lazydocker >/dev/null 2>&1 && alias lzd='lazydocker'

# ---- Per-machine overrides (never committed) ----
[ -f "$HOME/.zshrc.local" ] && source "$HOME/.zshrc.local"

